@model IEnumerable<AdministrareBlocMVC.Models.Locatar>
@using AdministrareBlocMVC.Models

@{
    ViewData["Title"] = "Utilizatori";
}

<h1>Utilizatori</h1>

<form method="get" class="mb-3 d-flex gap-2">
    <input type="text"
           name="q"
           value="@Context.Request.Query["q"]"
           class="form-control form-control-sm"
           placeholder="Cauta utilizator dupa email..." />
    <button type="submit" class="btn btn-sm btn-primary">Cauta</button>
</form>

<table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
        <tr>
            <th style="width: 220px;">Email</th>
            <th>Apartament asignat</th>
            <th style="width: 120px;">Nr persoane</th>
            <th style="width: 100px;">Actiuni</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var u in Model)
        {
            var ap = u.Apartament;

            <tr>
                <td>@u.Email</td>

                <td>
                    @if (ap == null)
                    {
                        <span class="text-muted">Neasignat</span>
                    }
                    else
                    {
                        var scaraTxt = string.IsNullOrWhiteSpace(ap.Scara)
                        ? ""
                        : $" - Scara {ap.Scara}";

                        <div>
                            <b>@ap.Bloc?.Nume@scaraTxt</b>
                            <span class="text-muted">(@ap.Bloc?.Adresa) Ap @ap.Numar, Etaj @ap.Etaj</span>
                        </div>

                        @if (!string.IsNullOrWhiteSpace(ap.NumeProprietar))
                        {
                            <div class="small">
                                <span class="text-muted">Proprietar:</span>
                                <b>@ap.NumeProprietar</b>
                            </div>
                        }

                        @if (ap.Chirias != null && !string.IsNullOrWhiteSpace(ap.Chirias.NumeChirias))
                        {
                            <div class="small">
                                <span class="text-muted">Chirias:</span>
                                <b>@ap.Chirias.NumeChirias</b>
                            </div>
                        }
                    }
                </td>

                <td class="text-center">
                    @(ap == null ? "" : ap.NrPersoane.ToString())
                </td>

                <td class="text-center">
                    <a class="btn btn-sm btn-primary"
                       asp-action="Assign"
                       asp-route-id="@u.Id">
                        Asigneaza
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>
